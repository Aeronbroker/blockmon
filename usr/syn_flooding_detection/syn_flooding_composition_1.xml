<!--
Composition for SYN flooding detection without parallelization.
It has an input external gate called raw_packets1
It may not be used without connecting this gate.
-->

<composition id="syn_flooding1" app_id="syn_flood_det">
	<install>
	
		<threadpool id="syn_threads" num_threads="1" >
			<core number="0"/>
		</threadpool>
			
		<block id="syn_synchronizer" type="syn_synchronizer"  sched_type="active" threadpool="syn_threads"> 
			<params>
			    <sketch width="4096" depth="8" />
			</params>
		</block>
			
		<block id="tuple_parser1" type="tuple_parser"> 
			<params>
			</params>
		</block>
		
		<block id="tuple_demux1" type="tuple_demux" > 
			<params>
			  <gate_tcp state="on" />
			  <gate_udp state="off" />
			  <gate_other state="off" />
			</params>
		</block>
		
		<block id="syn_counter1" type="syn_counter"> 
			<params>
			    <export period="500000" />
			</params>
		</block>
		
		<block id="syn_flooding_detection" type="syn_flooding_detection"> 
			<params>
			    <cusum threshold="50" offset="10" mean_window="20" />
			</params>
		</block>

		<connection src_block="syn_synchronizer" src_gate="out_sketch_proto" dst_block="syn_counter1" dst_gate="in_sketch_proto" />
		
		<connection src_block="tuple_parser1" src_gate="out_pkt" dst_block="tuple_demux1" dst_gate="in_pkt" />
		
		<connection src_block="tuple_demux1" src_gate="out_pkt_tcp" dst_block="syn_counter1" dst_gate="in_pkt" />
		
		<connection src_block="syn_counter1" src_gate="out_sketch" dst_block="syn_flooding_detection" dst_gate="in_sketch" />

		<connection src_block="syn_flooding_detection" src_gate="out_alert" dst_block="syn_counter1" dst_gate="in_alert" />
		
        <ext_gate direction="in" block="tuple_parser1" gate="in_pkt" ext_name="raw_packets1" />

	</install>

</composition>


				
